<div class="create-check-container">
  <div class="header">
    <h2>יצירת שיק דיגיטלי</h2>
    <button class="btn btn-secondary" (click)="cancel()">חזור</button>
  </div>

  <!-- הודעות -->
  <div *ngIf="error" class="alert alert-error">{{ error }}</div>
  <div *ngIf="success" class="alert alert-success">{{ success }}</div>
  
  <!-- הודעה מיוחדת לשכפול שיק -->
  <div *ngIf="success && success.includes('מולא אוטומטית')" class="alert alert-info duplicate-info">
    <div class="duplicate-header">
      <span class="duplicate-icon">📋</span>
      <strong>שכפול שיק</strong>
    </div>
    <p>הטופס מולא אוטומטית עם נתוני השיק המקורי. ניתן לערוך את הפרטים לפי הצורך.</p>
    <ul class="duplicate-tips">
      <li>✓ מספר השק נוצר אוטומטית</li>
      <li>✓ איש הקשר נבחר אוטומטית</li>
      <li>✓ הסכום וההערות הועתקו</li>
      <li>✓ פרטי הבנק הועתקו (אם קיימים)</li>
      <li>⚠️ יש לעדכן את תאריך הפירעון</li>
    </ul>
  </div>

  <!-- טופס יצירת שק -->
  <form (ngSubmit)="onSubmit()" class="check-form" #formTemplate="ngForm">
    <h3>פרטי השק</h3>
    
    <div class="form-group">
      <label>מספר שק:</label>
      <input type="text" 
             [(ngModel)]="formData.check_number" 
             name="check_number" 
             readonly>
    </div>

    <!-- שדה מוטב -->
    <div class="form-group">
      <label>מוטב:</label>
      <input type="text" 
             [(ngModel)]="formData.payee_name" 
             name="payee_name" 
             (input)="onPayeeNameInput($event)"
>
    </div>

    <!-- פרטים נוספים -->
    <div class="form-group">
      <label>ת.ז/ח.פ:</label>
      <input type="text" 
             [(ngModel)]="formData.id_number" 
             name="id_number" 
             (input)="onIdNumberInput($event)"
>
    </div>

    <!-- כפתורי רדיו -->
    <div class="form-group">
      <label>סוג זיהוי:</label>
      <div class="radio-group-inline">
        <label class="radio-option">
          <input type="radio" 
                 name="identifier_type" 
                 value="phone" 
                 [(ngModel)]="formData.identifier_type"
                 (change)="onIdentifierTypeChange()">
          <span>מזהה מוטב (נייד)</span>
        </label>
        <label class="radio-option">
          <input type="radio" 
                 name="identifier_type" 
                 value="account" 
                 [(ngModel)]="formData.identifier_type"
                 (change)="onIdentifierTypeChange()">
          <span>מספר חשבון</span>
        </label>
      </div>
    </div>

    <!-- שדה נייד -->
    <div class="form-group" *ngIf="formData.identifier_type === 'phone'">
      <label>נייד:</label>
      <input type="text" 
             [(ngModel)]="formData.phone" 
             name="phone" 
             (input)="onPhoneInput($event)"
>
    </div>

    <!-- שדות סניף ומספר חשבון -->
    <div class="form-group" *ngIf="formData.identifier_type === 'account'">
      <div class="form-row">
        <div class="form-group">
          <label>סניף:</label>
          <input type="text" 
                 [(ngModel)]="formData.bank_branch" 
                 name="bank_branch" 
                 (input)="onBankBranchInput($event)">
        </div>
        <div class="form-group">
          <label>מספר חשבון:</label>
          <input type="text" 
                 [(ngModel)]="formData.account_number" 
                 name="account_number" 
                 (input)="onAccountNumberInput($event)">
        </div>
      </div>
    </div>

    <!-- שדות לשיקים פיזיים -->
    <div class="form-group" *ngIf="formData.is_physical">
      <label>{{ checkType === 'outgoing' ? 'שם המוטב' : 'שם המשלם' }}:</label>
      <input type="text" 
             [(ngModel)]="formData.payee_name" 
             name="payee_name">
    </div>

    <div class="form-group">
      <label>סכום (₪):</label>
      <input type="text" 
             [(ngModel)]="formData.amount" 
             name="amount" 
             (input)="onAmountInput($event)">
    </div>

    <div class="form-group">
      <label>תאריך פירעון:</label>
      <input type="date" 
             [(ngModel)]="formData.due_date" 
             name="due_date" 
>
    </div>


    <div *ngIf="checkType === 'incoming'" class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" 
               [(ngModel)]="formData.deposit_immediately" 
               name="deposit_immediately">
        <span>הפקד מיד</span>
      </label>
    </div>

    <div class="form-group">
      <label>הערות:</label>
      <textarea [(ngModel)]="formData.notes" 
                name="notes" 
                rows="3" 
                placeholder="הערות נוספות..."></textarea>
    </div>

    <!-- checkbox סדרת שיקים -->
    <div class="form-group">
      <label class="checkbox-label">
        <input type="checkbox" 
               [(ngModel)]="isSeries" 
               name="isSeries"
               (change)="onSeriesToggle()">
        <span>סדרת שיקים</span>
      </label>
    </div>

    <!-- שדות סדרת שיקים -->
    <div *ngIf="isSeries" class="series-fields">
      <div class="form-row">
        <div class="form-group">
          <label>מספר שקים בסדרה:</label>
          <input type="number" 
                 [(ngModel)]="seriesForm.total_checks" 
                 name="total_checks" 
>
        </div>
        <div class="form-group">
          <label>יום בחודש (1-31):</label>
          <input type="number" 
                 [(ngModel)]="seriesForm.day_of_month" 
                 name="day_of_month" 
>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" 
              class="btn btn-secondary" 
              (click)="cancel()">
        ביטול
      </button>
      <button type="submit" 
              class="btn btn-primary" 
              [disabled]="loading">
        {{ loading ? 'יוצר...' : (isSeries ? 'צור סדרה' : 'צור שק') }}
      </button>
    </div>
  </form>

</div>
