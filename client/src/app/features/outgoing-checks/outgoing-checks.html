<div class="outgoing-checks-container">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-btn" (click)="goBackToDashboard()">
          ← חזרה ללובי
        </button>
      </div>
      <div class="header-center">
        <h1>שיקים יוצאים</h1>
      </div>
      <div class="header-right">
        <button class="create-btn" (click)="navigateToCreateCheck()">
          ✏️ יצירת שיק דיגיטלי
        </button>
        <button class="physical-check-btn" (click)="addPhysicalCheck()">
          📄 הוסף שק פיזי
        </button>
      </div>
    </div>
  </header>

  <!-- Top Controls -->
  <div class="top-controls">
    <button class="save-print-btn" (click)="printAllChecks()">
      <span class="save-icon">🖨️</span>
      <span>הדפס כל השקים</span>
    </button>
    <button class="export-btn" (click)="exportToExcel()">
      <span class="export-icon">📊</span>
      <span>ייצא לאקסל</span>
    </button>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filters-row">
      <div class="filter-group">
        <label>סטטוס:</label>
        <select [(ngModel)]="filters.status" (change)="applyFilters()">
          <option *ngFor="let status of statuses" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>תקופה:</label>
        <select [(ngModel)]="filters.start_date" (change)="applyFilters()">
          <option value="">כל התקופות</option>
          <option *ngFor="let range of dateRanges" [value]="range.value">
            {{ range.label }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>מינימום סכום:</label>
        <input type="number" [(ngModel)]="filters.min_amount" (change)="applyFilters()" placeholder="0">
      </div>
      
      <div class="filter-group">
        <label>מקסימום סכום:</label>
        <input type="number" [(ngModel)]="filters.max_amount" (change)="applyFilters()" placeholder="999999">
      </div>
      
      <div class="filter-group">
        <label>מספר שק:</label>
        <input type="text" 
               [(ngModel)]="filters.check_number" 
               (change)="applyFilters()" 
               placeholder="הזן מספר שק"
               pattern="[0-9]*"
               inputmode="numeric">
      </div>
      
      <div class="filter-actions">
        <button class="search-btn" (click)="applyFilters()">
          🔍 חפש
        </button>
        <button class="clear-btn" (click)="clearFilters()">
          נקה פילטרים
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner"></div>
    <p>טוען שקים יוצאים...</p>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error">
    <div class="error-message">
      <span class="error-icon">⚠️</span>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadChecks()">נסה שוב</button>
    </div>
  </div>

  <!-- Checks Table -->
  <div class="table-container" *ngIf="!loading && !error">
    <table class="checks-table">
      <thead>
        <tr>
          <th>סוג השיק</th>
          <th>תאריך פירעון</th>
          <th>סכום</th>
          <th>שם המוטב</th>
          <th>סטטוס</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let check of checks">
          <tr 
            class="check-row"
            [ngClass]="getRowClass(check)"
            (click)="toggleRowExpansion(check)">
            <td class="check-type">
              <span class="type-icon" 
                    [title]="check.is_physical ? 'פיזי' : 'דיגיטלי'"
                    [ngClass]="check.is_physical ? 'physical-icon' : 'digital-icon'">
                {{ check.is_physical ? '📄' : '💻' }}
              </span>
            </td>
            <td class="due-date">{{ formatDate(check.due_date) }}</td>
            <td class="amount">{{ formatAmount(check.amount) }}</td>
            <td class="payee-name">{{ check.payee_name || 'לא זמין' }}</td>
            <td class="status">
              <div class="status-container">
                <span class="status-badge" [ngClass]="getStatusClass(getEffectiveStatus(check))">
                  {{ getStatusLabel(getEffectiveStatus(check)) }}
                </span>
                <span class="expand-arrow" [ngClass]="{'expanded': isRowExpanded(check)}">▼</span>
              </div>
            </td>
          </tr>
          
          <!-- Expanded Row Drawer -->
          <tr *ngIf="isRowExpanded(check)" class="expanded-row">
            <td colspan="5" class="drawer-content">
              <div class="drawer-header">
                <h3>פרטי שק יוצא</h3>
                <button class="close-drawer-btn" (click)="toggleRowExpansion(check)">×</button>
              </div>
              
              <div class="drawer-body">
                <!-- Check Visual -->
                <div class="check-visual">
                  <div class="check-header">
                    <div class="bank-name">שק בנק</div>
                    <div class="bank-name-en">Bank Check</div>
                  </div>
                  
                  <div class="check-details">
                    <div class="check-field">
                      <label>בנק:</label>
                      <span>{{ check.bank_name || 'הפועלים' }}</span>
                    </div>
                    <div class="check-field">
                      <label>סניף:</label>
                      <span>{{ check.bank_branch || '123' }}</span>
                    </div>
                    <div class="check-field">
                      <label>תאריך:</label>
                      <span>{{ formatDate(check.due_date) }}</span>
                    </div>
                    <div class="check-field">
                      <label>שלם לפי הוראת:</label>
                      <span class="payee-name-large">{{ check.payee_name || 'לא זמין' }}</span>
                    </div>
                    <div class="amount-section">
                      <div class="amount-label">סכום:</div>
                      <div class="amount-value">{{ formatAmount(check.amount) }}</div>
                    </div>
                    <div class="check-field">
                      <label>מספר שק:</label>
                      <span>{{ check.check_number }}</span>
                    </div>
                    <div class="check-type">
                      <span class="type-badge" [ngClass]="check.is_physical ? 'physical' : 'digital'">
                        {{ check.is_physical ? '📄 שק פיזי' : '💻 שק דיגיטלי' }}
                      </span>
                    </div>
                  </div>
                </div>

                <!-- Actions -->
                <div class="drawer-actions">
                  <h4>פעולות</h4>
                  
                  <!-- כפתור הדפסה - תמיד ראשון -->
                  <button class="action-btn print-btn" (click)="printCheck()">
                    🖨️ הדפסה
                  </button>
                  
                  <!-- כפתורים לשיקים דיגיטליים -->
                  <ng-container *ngIf="!selectedCheck?.is_physical">
                    <!-- כפתור ביטול - רק למצב ממתין לפירעון -->
                    <button *ngIf="selectedCheck?.status === 'pending'" 
                            class="action-btn cancel-btn" 
                            (click)="cancelCheck()"
                            title="ביטול שק זמין רק למצב ממתין לפירעון">
                      🚫 ביטול שק
                    </button>
                    
                    <!-- כפתור שכפול - רק למצבים לא פגי תוקף -->
                    <button *ngIf="selectedCheck?.status !== 'expired'" 
                            class="action-btn duplicate-btn" 
                            (click)="duplicateCheck()">
                      📋 שכפול שק
                    </button>
                  </ng-container>
                  
                  <!-- כפתורים לשיקים פיזיים -->
                  <ng-container *ngIf="selectedCheck?.is_physical">
                    <div class="physical-check-notice">
                      <span class="notice-icon">📄</span>
                      <span class="notice-text">שיק פיזי - זמין למעקב בלבד</span>
                    </div>
                  </ng-container>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>

    <!-- No Data -->
    <div class="no-data" *ngIf="checks.length === 0">
      <div class="no-data-icon">📋</div>
      <h3 *ngIf="!hasActiveFilters()">לא נמצאו שקים יוצאים</h3>
      <h3 *ngIf="hasActiveFilters()">לא נמצאו תוצאות לחיפוש</h3>
      <p *ngIf="!hasActiveFilters()">אין שקים יוצאים במערכת</p>
      <p *ngIf="hasActiveFilters()">אין שקים יוצאים התואמים לפילטרים שנבחרו</p>
      <button class="create-btn" (click)="navigateToCreateCheck()" *ngIf="!hasActiveFilters()">
        יצירת שיק דיגיטלי ראשון
      </button>
      <button class="clear-btn" (click)="clearFilters()" *ngIf="hasActiveFilters()">
        נקה פילטרים
      </button>
    </div>
  </div>

</div>